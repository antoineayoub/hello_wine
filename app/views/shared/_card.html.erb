<div class="col-xs-12">
  <div class="card-banner card-backg text-center">
      <%= link_to wine_path(wine) do %>
        <h1><%= wine.name %></h1>
      <% end %>

  </div>
</div>

<div class="col-xs-12">
  <div class="card-container text-center card-backg">
    <div class="card-element">
      <i class="fa fa-euro fa-2x"></i>
      <h2><%= sprintf('%.2f', wine.price).gsub('.', ',')%> â‚¬</h2>
      <p>Best price</p>
    </div>
    <div class="card-element">
      <% unless wine.external_ratings[2].nil? %>
      <i class="fa fa-star fa-2x"></i>
      <h2><%= wine.external_ratings[2].avg_rating %></h2>
      <% end %>
      <p>Notes</p>
    </div>
    <div class="card-element">
      <i class="fa fa-map-marker fa-2x"></i>
      <h2><%= wine.brand.name %> </h2>
      <h1> <%= wine.nearest(@latitude,@longitude)[:distance] %>
      <p>200m</p>
    </div>
    <div class="card-element">
      <i class="fa fa-clock-o fa-2x"></i>
      <h2 class="color-open">Open</h2>
      <p>20:00</p>
    </div>
  </div>
</div>
<div class="col-xs-12">
  <div id="card-wine">
    <%= image_tag(wine.photo, class: "img_resize", id: "wine-pic") %>
    <div id="card-description" class="hide "><%= truncate(wine.description, length: 130) %></div>
  </div>
</div>
<div class="col-xs-12">
  <div class="card-container card-backg text-center">
    <div class="card-element">
      <% if wine.color == "Blanc" %>
        <i class="fa fa-circle fa-2x dot-white"></i>
        <h2>White</h2>
      <% elsif wine.color == "Rouge" %>
        <i class="fa fa-circle fa-2x dot-red"></i>
        <h2>Red</h2>
      <% else %>
        <i class="fa fa-circle fa-2x dot-rose"></i>
        <h2>Pink</h2>
      <% end %>
    </div>
    <div class="card-element">
      <i class="fa fa-globe fa-2x"></i>
      <h2><%= wine.region %></h2>
    </div>
    <div class="card-element">
      <i class="fa fa-percent fa-2x"></i>
      <h2><%= wine.alcohol_percent %></h2>
    </div>
  </div>
</div>
<div class="col-xs-12">

</div>
<div class="col-xs-12">
  <div>
      <!-- <div id="map" style="width: 100%; height: 600px;"></div> -->
  </div>
</div>

<%= simple_form_for @wines(wine) do |f| %>
  <%= f.input :color, :as => :hidden %>
  <%= f.input :meal, :as => :hidden %>
  <%= f.input :price, :as => :hidden %>
  <%= f.input :latitude, :as => :hidden %>
  <%= f.input :longitude, :as => :hidden %>
  <%= f.button :submit, :class => "hidden" %>
<% end %>


<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).on('ready', function() {

      handler = Gmaps.build('Google');
      handler.buildMap({ internal: { id: 'map' } }, function(){
        markers = handler.addMarkers(<%= raw @markers.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        if(navigator.geolocation)
          navigator.geolocation.getCurrentPosition(displayOnMap);
        calcRoute();
        directionsDisplay.setMap(handler.getMap());

      });
    });

    $( "#card-wine" ).click(function() {
      $( "#wine-pic" ).fadeOut( "slow", function() {
        $("#card-description").removeClass("hide");
        // Animation complete
      });
    });
    $( "#card-description" ).click(function() {
      $( "#wine-pic" ).fadeIn( "slow", function() {
        $("#card-description").addClass("hide");
        // Animation complete
      });
    });
    function displayOnMap(position){
      var marker = handler.addMarker({
        lat: position.coords.latitude,
        lng: position.coords.longitude
      });
      handler.map.centerOn(marker);
    };

    var directionsDisplay = new google.maps.DirectionsRenderer();
    var directionsService = new google.maps.DirectionsService();

  <% end %>
<% end %>
