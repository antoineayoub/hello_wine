<div class="questions-wrapper text-center meal-background">
  <% @questions.each_with_index do |question, index| %>
  <div class="container">
    <div class="row">
      <div class="question-wrapper hide" data-type="<%= question[0].to_s %>" data-ft="<%= index+1 %>">
        <div class="col-xs-12">
          <div class="sur-lg-padding title-styling">
            <%= question[1][:question] %>
          </div>
        </div>
        <% question[1][:answers].each_with_index do |answer, index| %>
        <div class="row">
          <div class="col-xs-12">
            <div class="sur-md-padding">
              <a  class="btn btn-primary btn-question" data-q="<%= question[0].to_s %>"
                  data-value="<%= question[1][:values][index] %>">
                  <%= answer %>
              </a>
            </div>
          </div>
        </div>
        <% end %>
        <div class="row">
          <div class="col-xs-6">
            <div class="btn-back">
              <a  class="btn">Previous</a>
            </div>
          </div>
          <div class="col-xs-6">
            <div class="btn-skip">
              <a  class="btn">Skip</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <% end %>
</div>

<%= simple_form_for @user_answer do |f| %>
  <%= f.input :meal, :as => :hidden %>
  <%= f.input :color, :as => :hidden %>
  <%= f.input :price, :as => :hidden %>
  <%= f.button :submit, :class => "hidden" %>
<% end %>


<% content_for(:after_js) do %>
  <script>

    // NOTE : DOES NOT OVERWRITE QUESTIONAIRE WHEN BACK

    // on first page load removes ".hide" on first element
    $('*[data-ft="1"]').removeClass("hide");

    var questionToShow        = 1;
    var questionTotalNumber   = <%= raw @questions.length %> ;

    // next question
    $(".btn-question").click(function(){
      // question count variable
      questionToDisplay(1, $(this));
      recordAnswer($(this));
      submitQuestionaire();
    })

    // back button
    $(".btn-back").click(function(){
      // question count variable
      questionToDisplay(0);
      questionToShow    += -1;
    })

    // skip question
    $(".btn-skip").click(function(){
      // question count variable
      questionToDisplay(1);
      submitQuestionaire();
    })


    function questionToDisplay(direction, button) {
      questionToShow += direction;

      // hide or show the right question
      $("*[data-ft="+ (questionToShow - 1) +"]").toggleClass("hide");
      $("*[data-ft="+ questionToShow +"]").toggleClass("hide");

      var type = $("*[data-ft="+ questionToShow +"]").attr("data-type");
      var css_class = type + "-background";

      var type_1 = $("*[data-ft="+ (questionToShow - 1) +"]").attr("data-type");
      var css_class_1 = type_1 + "-background";

      $(".questions-wrapper").addClass(css_class);
      $(".questions-wrapper").removeClass(css_class_1);
    }


    function recordAnswer(elementClicked) {
      $this = elementClicked

      // retrieve user answer on btn click
      var answer        = $this.attr("data-value");
      var formAnswerID  = "#user_answer_"+ $this.attr("data-q") +""

      // populates form
      $(formAnswerID).val(answer);
    }

    function submitQuestionaire() {
      // on last question, submit the form
      if ((questionToShow - 1) == questionTotalNumber) {
        $("#new_user_answer").submit();
      }
    }


  </script>
<% end %>
